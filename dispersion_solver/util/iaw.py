from plasmapy.formulary.dispersionfunction import plasma_dispersion_func
from .parameters import PlasmaParameters
import numpy as np
from numpy import loadtxt
import matplotlib as plt

"Normalized permittivity"


def eps_IAW(omg, kx, ky, kz, prt=PlasmaParameters(),
            Ze=plasma_dispersion_func,
            Zi=plasma_dispersion_func):
    def Zep(x):
        return -2 * (1 + x * Ze(x))

    def Zip(x):
        return -2 * (1 + x * Zi(x))

    kp = np.sqrt(ky ** 2 + kz ** 2)
    k2 = kx ** 2 + kp ** 2

    if k2 == 0:
        raise RuntimeError("The wave vector is Zero !!")

    iChi = (omg) / (ky * prt.vti/prt.BohmSpeed)
    eChi = (omg - ky * prt.driftSpeed/prt.BohmSpeed) / (ky * prt.vte/prt.BohmSpeed)

    iEps = 1 / (ky**2 * (prt.vti/prt.BohmSpeed) ** 2) * Zip(iChi)
    eEps = (prt.electronPlasmaFrequency/prt.ionPlasmaFrequency) ** 2 / (ky**2 * (prt.vte/prt.BohmSpeed) ** 2) * Zep(eChi)

    return 1 - iEps - eEps

def analytic_IAW(k, ti=0):
    return np.sqrt(1/(1 + 1/(k**2))*(1 + 3*ti*(1+k**2)))


def analytic_IAW_simple(k, ti=0):
    return np.sqrt(1/(1 + 1/(k**2)))

def first_guess(k):
    kappa = [0.01,  0.02,  0.03,  0.04,  0.05,  0.060000000000000005,  0.06999999999999999,  0.08,  0.09,  0.09999999999999999,  0.11,  0.12,  0.13,  0.14,  0.15000000000000002,  0.16,  0.17,  0.18000000000000002,  0.19,  0.2,  0.21000000000000002,  0.22,  0.23,  0.24000000000000002,  0.25,  0.26,  0.27,  0.28,  0.29000000000000004,  0.3,  0.31,  0.32,  0.33,  0.34,  0.35000000000000003,  0.36000000000000004,  0.37,  0.38,  0.39,  0.4,  0.41000000000000003,  0.42000000000000004,  0.43,  0.44,  0.45,  0.46,  0.47000000000000003,  0.48000000000000004,  0.49,  0.5,  0.51,  0.52,  0.53,  0.54,  0.55,  0.56,  0.5700000000000001,  0.5800000000000001,  0.59,  0.6,  0.61,  0.62,  0.63,  0.64,  0.65,  0.66,  0.67,  0.68,  0.6900000000000001,  0.7000000000000001,  0.7100000000000001,  0.72,  0.73,  0.74,  0.75,  0.76,  0.77,  0.78,  0.79,  0.8,  0.81,  0.8200000000000001,  0.8300000000000001,  0.8400000000000001,  0.85,  0.86,  0.87,  0.88,  0.89,  0.9,  0.91,  0.92,  0.93,  0.9400000000000001,  0.9500000000000001,  0.9600000000000001,  0.97,  0.98,  0.99,  1.0,  1.01,  1.02,  1.03,  1.04,  1.05,  1.06,  1.07,  1.08,  1.09,  1.1,  1.11,  1.12,  1.1300000000000001,  1.1400000000000001,  1.1500000000000001,  1.1600000000000001,  1.17,  1.18,  1.19,  1.2,  1.21,  1.22,  1.23,  1.24,  1.25,  1.26,  1.27,  1.28,  1.29,  1.3,  1.31,  1.32,  1.33,  1.34,  1.35,  1.36,  1.37,  1.3800000000000001,  1.3900000000000001,  1.4000000000000001,  1.4100000000000001,  1.42,  1.43,  1.44,  1.45,  1.46,  1.47,  1.48,  1.49,  1.5,  1.51,  1.52,  1.53,  1.54,  1.55,  1.56,  1.57,  1.58,  1.59,  1.6,  1.61,  1.62,  1.6300000000000001,  1.6400000000000001,  1.6500000000000001,  1.6600000000000001,  1.6700000000000002,  1.68,  1.69,  1.7,  1.71,  1.72,  1.73,  1.74,  1.75,  1.76,  1.77,  1.78,  1.79,  1.8,  1.81,  1.82,  1.83,  1.84,  1.85,  1.86,  1.87,  1.8800000000000001,  1.8900000000000001,  1.9000000000000001,  1.9100000000000001,  1.9200000000000002,  1.93,  1.94,  1.95,  1.96,  1.97,  1.98,  1.99,  2.0]

    omega = [3.855632314097145e-05,  0.00026833655939895314,  0.0009742504069268391,  0.0031373186350854556,  0.014960261299687382,  0.42437735324334547,  0.40512650098888103,  0.32536987921794247,  0.2987927593128488,  0.2860996150792098,  0.2789427781668748,  0.2744397449334318,  0.27134881621866547,  0.2690599646597466,  0.2672456420725374,  0.26571812431307906,  0.2643642213748332,  0.2631128008643359,  0.26191756398328125,  0.26074743059344274,  0.25958094081340566,  0.25840287741453283,  0.2572021648650509,  0.25597052708628976,  0.2547016092931358,  0.25339039096056637,  0.25203278553322894,  0.25062536231027854,  0.24916514967221806,  0.24764949330106367,  0.24607595207140937,  0.2444422200267008,  0.24274606655851155,  0.24098528933917696,  0.23915767617256645,  0.23726097301628668,  0.2352928561613924,  0.2332509070581626,  0.23113258861196223,  0.22893522199978739,  0.22665596319793674,  0.22429177849371318,  0.2218394182825023,  0.21929538844129887,  0.2166559185173218,  0.21391692587730476,  0.21107397482547538,  0.20812222950431697,  0.20505639913187376,  0.20187067378005719,  0.19855864843134688,  0.1951132324254195,  0.19152654056167856,  0.18778976096663577,  0.18389299323900143,  0.17982504814428785,  0.1755731969439842,  0.17112285382082076,  0.16645716803514166,  0.16155649213196713,  0.15639767655629697,  0.15095311562740021,  0.1451894280979164,  0.13906558445366196,  0.13253016683349783,  0.1255172116173186,  0.11793961717333384,  0.1096781019569388,  0.10056136612657612,  0.09032696287287961,  0.07853328653842076,  0.06431721408350072,  0.04542648587812906,  0.017884598838875828,  0.1893103369039436,  0.30108212094098963,  0.3956698471439918,  0.48048703122322756,  0.5586838696950294,  0.6319743425778335,  0.7014228029296251,  0.7677479741714965,  0.831463874791651,  0.892954805015603,  0.952517428923843,  1.010386690742037,  1.0667533168015808,  1.121774163796529,  1.1755806522677785,  1.2282839093830793,  1.2799795515983132,  1.3307500684828282,  1.3806674099951473,  1.429795066678429,  1.478188587790354,  1.5258984243553315,  1.5729690152412608,  1.6194403927835719,  1.6653490111342575,  1.7107277133797147,  1.7556065972129733,  1.800012941718189,  1.843971916946125,  1.887506635435309,  1.9306383912574834,  1.9733871484657524,  2.0157709642030923,  2.0578063064743795,  2.0995097281959363,  2.140895403891278,  2.1819776075463855,  2.2227683714508886,  2.263280569143788,  2.3035252185415076,  2.3435129239086185,  2.383253653294454,  2.4227567139949278,  2.4620315250850773,  2.5010861620489906,  2.5399286019309426,  2.578566630185567,  2.6170071121135026,  2.6552570635918826,  2.6933228021757447,  2.731210561059072,  2.7689262097896776,  2.806475250710627,  2.843863219388096,  2.8810949475133403,  2.9181752628692816,  2.9551088638181797,  2.9919000503372057,  3.028553804797194,  3.0650731769392574,  3.101462034747448,  3.1377253623313477,  3.173865388701417,  3.2098865282704896,  3.2457910297999524,  3.281582839377294,  3.3172648451655666,  3.352840050622163,  3.388311212016305,  3.423680811045725,  3.45895163621938,  3.4941263139175724,  3.529207331979239,  3.5641969622039653,  3.599096877994125,  3.633909995970069,  3.6686384391822116,  3.7032839174271057,  3.737848579557655,  3.7723340606508122,  3.806742570867213,  3.8410755455594408,  3.8753350165370755,  3.9095223444021734,  3.9436395425496484,  3.9776879666263323,  4.011669033364692,  4.0455843088799615,  4.079435167739076,  4.113222970001173,  4.146949149877813,  4.18061511146119,  4.21422206978208,  4.247771035378959,  4.281263406546335,  4.314700569582596,  4.348083274108458,  4.381412327435914,  4.414689426831379,  4.447915293166931,  4.481091748751377,  4.514217973969958,  4.547296376979274,  4.5803272610683035,  4.613312135719262,  4.646251212622495,  4.67914614799415,  4.7119966387934635,  4.7448043180274935,  4.777570047829907,  4.810294146361882,  4.842977462254822,  4.875620967453994,  4.9082252784479845,  4.940791176714205,  4.973318992771403,  5.005809729585305,  5.038263739312466,  5.070682088073876,  5.103065125771565,  5.135413517281476,  5.167727729828497,  5.200008286154768,  5.232256043000801,  5.264471630106382,  5.296655127049349 ]

    gamma = [0.01929112168263168,  0.07899953459381749,  0.21820268606147233,  0.3931367521482255,  -1.6610537523921508e-13,  -5.904551852013282e-14,  -4.813271452205127e-14,  -4.3254306394836343e-14,  -4.131658532846137e-14,  -3.809036966662386e-14,  -3.284554633394481e-14,  -3.261294652280176e-14,  -3.1782462160068135e-14,  -2.7959336312050164e-14,  -2.6809459705785437e-14,  -1.8426161592999977e-14,  -1.68425705247396e-14,  -1.6718317424532536e-14,  -1.663028118249481e-14,  -1.6345967783956748e-14,  -1.5907851167627992e-14,  -1.5106681067127153e-14,  -1.4365306688768522e-14,  -1.3475478362265226e-14,  -1.3544908139162957e-14,  -1.2947230549687175e-14,  -1.3259020765677014e-14,  -1.002058958444217e-14,  -1.0336170084703938e-14,  -1.0458775411055799e-14,  -1.0540414552363126e-14,  -9.912358808353359e-15,  -1.0000982647840389e-14,  -8.095322148894954e-15,  -8.378110676141048e-15,  -8.229464035114274e-15,  -8.142574292590275e-15,  -7.952078414306661e-15,  -7.948865181516736e-15,  -7.923345124524461e-15,  -7.92507213483798e-15,  -7.830030118980966e-15,  -7.542541067682619e-15,  -7.526874478188528e-15,  -7.61310841382827e-15,  -7.505896531177422e-15,  -7.401934505175567e-15,  -7.434061740298314e-15,  -7.0887001304337774e-15,  -6.8399938243222575e-15,  -6.4303618140330674e-15,  -6.187145429667026e-15,  -5.8962534655680845e-15,  -5.601649371193956e-15,  -5.549187978419591e-15,  -5.694907869564774e-15,  -5.626719796567747e-15,  -5.5777898905821654e-15,  -5.251218156132856e-15,  -4.9445151849742605e-15,  -5.011794363207949e-15,  -4.6949503297974776e-15,  -4.683634116528907e-15,  -4.7217629968058855e-15,  -4.5761684383630385e-15,  -4.542048615280285e-15,  -4.450639398827157e-15,  -4.462417525526309e-15,  -4.485184490883563e-15,  -4.498042091064272e-15,  -4.297050571920531e-15,  -4.276690512918996e-15,  -4.306969652797338e-15,  -4.295417373037527e-15,  -4.158994777455342e-15,  -3.985863532698582e-15,  -4.192681161322647e-15,  -4.366781659703385e-15,  -3.95656549120208e-15,  -3.9965005565115775e-15,  -4.021367911099053e-15,  -3.845635967812966e-15,  -3.831101191607753e-15,  -3.965062186472888e-15,  -3.1404249634940974e-15,  -2.876678467582503e-15,  -2.644266652591003e-15,  -2.7538156446718858e-15,  -2.779103062486947e-15,  -2.694593868572909e-15,  -2.67804018874953e-15,  -2.6753054953118853e-15,  -2.7876889684751756e-15,  -2.8720242444042346e-15,  -2.7454786258423086e-15,  -2.8802710390039025e-15,  -2.65257840063057e-15,  -2.585760679000606e-15,  -2.602830901807083e-15,  -2.52152624202787e-15,  -2.2729822117602355e-15,  -2.279859737861685e-15,  -2.247645291389236e-15,  -2.137133102174615e-15,  -2.068124440843014e-15,  -2.0065984195452037e-15,  -2.026942639987156e-15,  -2.015910832491572e-15,  -2.0317994658518377e-15,  -2.04075595863881e-15,  -2.031501516721908e-15,  -1.889649533580043e-15,  -1.813672129074099e-15,  -1.8248749375862626e-15,  -1.7868251783881844e-15,  -1.789692816504887e-15,  -1.7812500806670473e-15,  -1.6999404980271532e-15,  -1.7539896416950816e-15,  -1.6634083472030923e-15,  -1.6636447780131105e-15,  -1.6515579848104678e-15,  -1.5325220543101697e-15,  -1.506712500643912e-15,  -1.4990779795648484e-15,  -1.4715141998047492e-15,  -1.3116152658494705e-15,  -1.3148961009442437e-15,  -1.3088841288500878e-15,  -1.2669899071926899e-15,  -1.3402346463011882e-15,  -1.3585556316256876e-15,  -1.309769058539407e-15,  -1.231178501328449e-15,  -1.2051904643716724e-15,  -1.2436829983606208e-15,  -1.1569544105102356e-15,  -1.209798983556697e-15,  -1.180772236815206e-15,  -1.174071131359443e-15,  -1.1822245051161173e-15,  -1.226527880018174e-15,  -1.2467098216685532e-15,  -1.2706025149550794e-15,  -1.3073920543051344e-15,  -1.3202392733493832e-15,  -1.3291205583589824e-15,  -1.3261513579217324e-15,  -1.3013437567677253e-15,  -1.2600850084648041e-15,  -1.271861702732629e-15,  -1.2954591610996221e-15,  -1.3728826973747934e-15,  -1.3349091980322866e-15,  -1.2630271451369013e-15,  -1.2070342198555188e-15,  -1.2074044819239105e-15,  -1.189652414935374e-15,  -1.202696395143448e-15,  -1.1925090092637036e-15,  -1.1887782810700783e-15,  -1.1171687718170133e-15,  -1.156306317580175e-15,  -1.2078607940288197e-15,  -1.1172036238681024e-15,  -1.129095957595653e-15,  -1.1296680486598847e-15,  -1.1430577628648366e-15,  -1.1295151708967143e-15,  -1.1132641975446634e-15,  -1.113147688472525e-15,  -1.0006443798815806e-15,  -9.446671139762938e-16,  -9.759058130263754e-16,  -9.547399506731893e-16,  -9.173256778359783e-16,  -9.484450908063061e-16,  -9.920742316512722e-16,  -9.550014839226843e-16,  -9.847866436689863e-16,  -9.526205302983012e-16,  -9.7160938981933e-16,  -9.68937842250465e-16,  -9.530410265576327e-16,  -9.716423271291215e-16,  -9.549590550798891e-16,  -9.613468099061336e-16,  -9.651007732200564e-16,  -9.770856328515703e-16,  -9.72069633786993e-16,  -9.440726840078227e-16,  -9.439294621776963e-16,  -9.396614619157543e-16,  -8.550085846668162e-16,  -8.143484527748231e-16,  -8.441722613818918e-16,  -7.928347215766646e-16,  -7.143277613688554e-16,  -6.912039737298475e-16,  -6.997260923154725e-16  ]

    return complex(omega[kappa.index(k)],gamma[kappa.index(k)])



def first_guess_1(k):

    kappa = [0.01,  0.012462311557788945,  0.014924623115577889,  0.017386934673366834,  0.01984924623115578,  0.022311557788944725,  0.024773869346733667,  0.027236180904522615,  0.029698492462311557,  0.032160804020100506,  0.03462311557788945,  0.037085427135678396,  0.03954773869346734,  0.04201005025125629,  0.04447236180904523,  0.04693467336683418,  0.04939698492462312,  0.05185929648241206,  0.05432160804020101,  0.05678391959798995,  0.0592462311557789,  0.06170854271356784,  0.06417085427135678,  0.06663316582914573,  0.06909547738693467,  0.07155778894472362,  0.07402010050251256,  0.0764824120603015,  0.07894472361809045,  0.0814070351758794,  0.08386934673366835,  0.08633165829145728,  0.08879396984924623,  0.09125628140703518,  0.09371859296482411,  0.09618090452261306,  0.09864321608040201,  0.10110552763819096,  0.1035678391959799,  0.10603015075376884,  0.10849246231155779,  0.11095477386934673,  0.11341708542713567,  0.11587939698492462,  0.11834170854271357,  0.12080402010050251,  0.12326633165829146,  0.1257286432160804,  0.12819095477386935,  0.1306532663316583,  0.13311557788944725,  0.1355778894472362,  0.13804020100502515,  0.1405025125628141,  0.14296482412060302,  0.14542713567839197,  0.14788944723618092,  0.15035175879396986,  0.1528140703517588,  0.15527638190954776,  0.1577386934673367,  0.16020100502512563,  0.16266331658291458,  0.16512562814070353,  0.16758793969849248,  0.17005025125628143,  0.17251256281407037,  0.17497487437185932,  0.17743718592964824,  0.1798994974874372,  0.18236180904522614,  0.1848241206030151,  0.18728643216080404,  0.189748743718593,  0.19221105527638194,  0.19467336683417086,  0.1971356783919598,  0.19959798994974876,  0.2020603015075377,  0.20452261306532665,  0.2069849246231156,  0.20944723618090455,  0.21190954773869347,  0.21437185929648242,  0.21683417085427137,  0.21929648241206032,  0.22175879396984927,  0.22422110552763821,  0.22668341708542716,  0.22914572864321608,  0.23160804020100503,  0.23407035175879398,  0.23653266331658293,  0.23899497487437188,  0.24145728643216083,  0.24391959798994978,  0.2463819095477387,  0.24884422110552765,  0.2513065326633166,  0.2537688442211055,  0.2562311557788945,  0.2586934673366834,  0.2611557788944724,  0.2636180904522613,  0.2660804020100503,  0.2685427135678392,  0.2710050251256282,  0.2734673366834171,  0.275929648241206,  0.278391959798995,  0.2808542713567839,  0.2833165829145729,  0.2857788944723618,  0.2882412060301508,  0.2907035175879397,  0.29316582914572864,  0.2956281407035176,  0.29809045226130654,  0.3005527638190955,  0.30301507537688444,  0.3054773869346734,  0.30793969849246233,  0.31040201005025125,  0.31286432160804023,  0.31532663316582915,  0.3177889447236181,  0.32025125628140705,  0.322713567839196,  0.32517587939698495,  0.32763819095477387,  0.33010050251256284,  0.33256281407035176,  0.33502512562814074,  0.33748743718592966,  0.33994974874371864,  0.34241206030150756,  0.3448743718592965,  0.34733668341708546,  0.3497989949748744,  0.35226130653266335,  0.3547236180904523,  0.35718592964824125,  0.3596482412060302,  0.3621105527638191,  0.36457286432160807,  0.367035175879397,  0.36949748743718597,  0.3719597989949749,  0.37442211055276386,  0.3768844221105528,  0.3793467336683417,  0.3818090452261307,  0.3842713567839196,  0.3867336683417086,  0.3891959798994975,  0.3916582914572865,  0.3941206030150754,  0.3965829145728643,  0.3990452261306533,  0.4015075376884422,  0.4039698492462312,  0.4064321608040201,  0.4088944723618091,  0.411356783919598,  0.41381909547738693,  0.4162814070351759,  0.41874371859296483,  0.4212060301507538,  0.42366834170854273,  0.4261306532663317,  0.4285929648241206,  0.43105527638190955,  0.4335175879396985,  0.43597989949748744,  0.4384422110552764,  0.44090452261306534,  0.4433668341708543,  0.44582914572864324,  0.44829145728643216,  0.45075376884422114,  0.45321608040201006,  0.45567839195979903,  0.45814070351758795,  0.46060301507537693,  0.46306532663316585,  0.4655276381909548,  0.46798994974874375,  0.47045226130653267,  0.47291457286432165,  0.47537688442211057,  0.47783919597989954,  0.48030150753768847,  0.4827638190954774,  0.48522613065326636,  0.4876884422110553,  0.49015075376884426,  0.4926130653266332,  0.49507537688442216,  0.4975376884422111,  0.5]

    omega = [4.88320673423024e-05,  8.944478097202891e-05,  0.00014939588566000966,  0.0002334113541021719,  0.00034721701422717134,  0.0004982103530642671,  0.0006965123402202559,  0.000956658073709723,  0.0013004218344792786,  0.001761768556396356,  0.002396028405123529,  0.003298033885233455,  0.004640855664237841,  0.006766782713851572,  0.010428373463826163,  0.01753499922369873,  0.03397104663542948,  0.08225758157344643,  0.23645029007056026,  0.5400259802101339,  0.9102020994460098,  0.5054755990857229,  0.425972783152448,  0.38466590286140795,  0.3587534811847632,  0.34089827488264324,  0.32786372893963517,  0.317963839674822,  0.3102224458409534,  0.3040310668957955,  0.29898907301759203,  0.29482129235993515,  0.2913322504500624,  0.2883792215304177,  0.2858555885594487,  0.28368015839130967,  0.28179007135926604,  0.2801359622104186,  0.27867857662458817,  0.2773863550482687,  0.2762336750116,  0.2751995513073996,  0.2742666605947238,  0.27342059978695127,  0.27264931548099225,  0.2719426602522725,  0.27129204422453257,  0.27069015900989457,  0.27013075719167623,  0.26960847484545347,  0.2691186877025765,  0.2686573938263288,  0.2682211173390478,  0.26780682898231445,  0.2674118802237953,  0.2670339483342599,  0.2666709903973059,  0.26632120463345343,  0.2659829977418323,  0.26565495721858456,  0.26533582780633935,  0.2650244913902351,  0.2647199497798649,  0.26442130991550117,  0.26412777112121066,  0.26383861408923376,  0.26355319133482624,  0.2632709189040162,  0.26299126915230975,  0.26271376443968497,  0.2624379716140942,  0.26216349717448373,  0.2618899830190017,  0.2616171027016687,  0.2613445581290314,  0.26107207664065957,  0.2607994084224323,  0.26052632421233535,  0.2602526132611569,  0.25997808151663526,  0.2597025500052569,  0.25942585338540086,  0.2591478386549334,  0.2588683639916393,  0.25858729771468913,  0.25830451734981963,  0.25801990878988185,  0.2577333655375471,  0.2574447880225581,  0.2571540829852977,  0.25686116291824757,  0.2565659455619623,  0.2562683534460435,  0.2559683134742533,  0.25566575654627277,  0.25536061721439646,  0.255052833369696,  0.25474234595706413,  0.2544290987145412,  0.25411303793415574,  0.2537941122447942,  0.2534722724118528,  0.2531474711540336,  0.2528196629755114,  0.2524888040103731,  0.2521548518812239,  0.25181776556742397,  0.25147750528477375,  0.2511340323727097,  0.25078730919243386,  0.2504372990298833,  0.2500839660084606,  0.24972727500586522,  0.24936719157789972,  0.24900368188759398,  0.248636712638823,  0.2482662510147708,  0.2478922646194,  0.2475147214245021,  0.24713358971832228,  0.24674883805813147,  0.24636043522579387,  0.24596835018524135,  0.24557255204318107,  0.24517301001154843,  0.24476969337155852,  0.24436257144037032,  0.24395161353841116,  0.2435367889599273,  0.24311806694276245,  0.2426954166405348,  0.2422688070968595,  0.24183820721804883,  0.24140358574991994,  0.24096491125267128,  0.24052215207829247,  0.2400752763475671,  0.23962425192913506,  0.23916904641721498,  0.23870962711095217,  0.23824596099433765,  0.23777801471576424,  0.23730575456872302,  0.23682914647165715,  0.23634815594910585,  0.2358627481121175,  0.23537288763983494,  0.23487853875995135,  0.23437966523055864,  0.2338762303197558,  0.23336819678867698,  0.2328555268703379,  0.23233818225210634,  0.23181612405537338,  0.23128931281697657,  0.23075770846798938,  0.2302212703149925,  0.2296799570197992,  0.22913372657799447,  0.2285825362981394,  0.22802634278097778,  0.2274651018977868,  0.22689876876683346,  0.2263272977320043,  0.22575064233875514,  0.22516875531108926,  0.2245815885261953,  0.22398909298941405,  0.22339121880947027,  0.22278791517095609,  0.22217913030800956,  0.2215648114753292,  0.2209449049199421,  0.22031935585148305,  0.2196881084104148,  0.21905110563837193,  0.21840828944340268,  0.21775960056734875,  0.21710497854975314,  0.2164443616934964,  0.21577768702480368,  0.21510489025718904,  0.2144259057481433,  0.21374066646086248,  0.21304910391766924,  0.21235114815714234,  0.21164672768726642,  0.21093576943615852,  0.21021819870238911,  0.20949393910194863,  0.2087629125146121,  0.208025039026419,  0.20728023687187058,  0.20652842237005775,  0.20576950986273695,  0.20500341164693275,  0.20423003790449665,  0.2034492966291193,  0.2026610935513553,  0.20186533205842755]

    gamma = [0.009485188701331212,  0.014320040944546652,  0.020225586287629854,  0.02722631712621506,  0.0353597803301241,  0.04468341707726203,  0.05528297526444616,  0.06728391250781386,  0.08086780039984584,  0.09629714467836399,  0.11395483918711319,  0.13441022143885878,  0.15853620515914268,  0.18773111809155507,  0.22437173253775322,  0.27281262222886526,  0.3416290947732263,  0.4459237656652719,  0.5717472531636139,  0.5715623220187133,  0.12887624908062173,  2.8250184868957674e-14,  2.937873309157586e-14,  3.0910133428516324e-14,  3.1686388692918565e-14,  3.260993564531512e-14,  3.4156344086592313e-14,  3.56302670099111e-14,  3.636356936525279e-14,  3.734934815917105e-14,  3.937407785558779e-14,  4.0815355018884945e-14,  4.1512567305771275e-14,  4.2444702248026886e-14,  4.434859032047745e-14,  4.596158626053302e-14,  4.7484275965424735e-14,  4.824579222973309e-14,  4.9220972396951544e-14,  5.054937233794611e-14,  5.295132057578639e-14,  5.476088496996088e-14,  5.6534220498362344e-14,  5.725518780086647e-14,  5.808592307191066e-14,  5.920085242468443e-14,  6.101586935626715e-14,  6.357652155729462e-14,  6.655938624463755e-14,  6.88832099105723e-14,  7.11835264398067e-14,  7.347106130886394e-14,  7.573164019413619e-14,  7.674767079202112e-14,  7.78086301980506e-14,  7.890683326296023e-14,  8.022904609890489e-14,  8.166609820160844e-14,  8.325203958485022e-14,  8.500717580123703e-14,  8.711155280551644e-14,  8.933099837591857e-14,  9.168768546861148e-14,  9.411513564218362e-14,  9.654767962063542e-14,  1.0062916905355428e-13,  1.0489371688448086e-13,  1.0931179728500824e-13,  1.1394883924694373e-13,  1.187875531931657e-13,  1.245871175489258e-13,  1.3058662170621958e-13,  1.3680177699114452e-13,  1.429676703979454e-13,  1.495870744839109e-13,  1.566531396156114e-13,  1.6415497373748445e-13,  1.7208359390985994e-13,  1.805102130341989e-13,  1.8817874097614122e-13,  1.961705958925591e-13,  2.0448112221360505e-13,  2.1308128085528997e-13,  2.2195243619912646e-13,  2.3134876480440726e-13,  2.4121573496594625e-13,  2.512453139935766e-13,  2.577208392920921e-13,  2.647251442649683e-13,  2.7169955269800233e-13,  2.7886957544609275e-13,  2.862207686539253e-13,  2.9360072169763246e-13,  3.0111733411740777e-13,  3.086689922201389e-13,  3.195622957919722e-13,  3.2735337851590246e-13,  3.3514824932012664e-13,  3.4301518897223804e-13,  3.502119894865531e-13,  3.574667547260864e-13,  3.6442742223667727e-13,  3.713647663824158e-13,  3.7834519687657495e-13,  3.852156835086011e-13,  3.920598762703843e-13,  3.9899064853696516e-13,  4.058070390349478e-13,  4.1252252286836514e-13,  4.13307838160757e-13,  4.1930389908180354e-13,  4.2525370555931393e-13,  4.309919822931193e-13,  4.3680271886583494e-13,  4.433163132975806e-13,  4.494240033523743e-13,  4.563911394575115e-13,  4.624568231119619e-13,  4.683877286036185e-13,  4.74177718946917e-13,  4.825948825755768e-13,  4.974427292640408e-13,  5.128061131748248e-13,  5.286971121737687e-13,  5.450150993340522e-13,  5.619885965066512e-13,  5.796492984402589e-13,  5.9801976784762e-13,  6.171003324287444e-13,  6.369797366331034e-13,  6.575979339795608e-13,  6.784936628662152e-13,  7.006746286276146e-13,  7.239293448728918e-13,  7.480900769410144e-13,  7.730310670364337e-13,  7.990149622011575e-13,  8.263653860595756e-13,  8.547321227314215e-13,  8.840901216060234e-13,  9.150401440553462e-13,  9.46724654427992e-13,  9.80736156194262e-13,  1.0164226893254157e-12,  1.0535101621417196e-12,  1.1023959218933171e-12,  1.1560001744202054e-12,  1.2110007971521699e-12,  1.2628269687088137e-12,  1.315690185107137e-12,  1.3718153674157476e-12,  1.4303062791357573e-12,  1.467627358714694e-12,  1.5079848382472621e-12,  1.5485236035314009e-12,  1.5899510520304468e-12,  1.6308034123071613e-12,  1.67259735612937e-12,  1.7143722052378207e-12,  1.759582330967059e-12,  1.8022197090819492e-12,  1.841161351216529e-12,  1.8806365743065165e-12,  1.9202321389267664e-12,  1.958140323988351e-12,  1.996142806933197e-12,  2.033359047125661e-12,  2.070617769569435e-12,  2.108383839333197e-12,  2.145492599865383e-12,  2.1819459272626246e-12,  2.1872232812632895e-12,  2.2197792882625943e-12,  2.2516086665394456e-12,  2.2785179600394983e-12,  2.312997650767095e-12,  2.3477212769749385e-12,  2.3807489864922102e-12,  2.4134043258088092e-12,  2.4455845661396524e-12,  2.4772453950990675e-12,  2.517374645821051e-12,  2.596164475728953e-12,  2.6778184671162934e-12,  2.7620540421072254e-12,  2.8495133943424097e-12,  2.940443777787332e-12,  3.035190799189263e-12,  3.1337677651187874e-12,  3.236658676599892e-12,  3.34352408611252e-12,  3.4552570575453992e-12,  3.5716128955372233e-12,  3.6925235923929855e-12,  3.817656969926117e-12,  3.923417156608447e-12,  4.056540213713341e-12,  4.199046273558039e-12,  4.34846163497009e-12,  4.50184270395323e-12]

    return complex(omega[kappa.index(k)],gamma[kappa.index(k)])

def first_guess_mod(k):

    kappa = [0.01,  0.012462311557788945,  0.014924623115577889,  0.017386934673366834,  0.01984924623115578,  0.022311557788944725,  0.024773869346733667,  0.027236180904522615,  0.029698492462311557,  0.032160804020100506,  0.03462311557788945,  0.037085427135678396,  0.03954773869346734,  0.04201005025125629,  0.04447236180904523,  0.04693467336683418,  0.04939698492462312,  0.05185929648241206,  0.05432160804020101,  0.05678391959798995,  0.0592462311557789,  0.06170854271356784,  0.06417085427135678,  0.06663316582914573,  0.06909547738693467,  0.07155778894472362,  0.07402010050251256,  0.0764824120603015,  0.07894472361809045,  0.0814070351758794,  0.08386934673366835,  0.08633165829145728,  0.08879396984924623,  0.09125628140703518,  0.09371859296482411,  0.09618090452261306,  0.09864321608040201,  0.10110552763819096,  0.1035678391959799,  0.10603015075376884,  0.10849246231155779,  0.11095477386934673,  0.11341708542713567,  0.11587939698492462,  0.11834170854271357,  0.12080402010050251,  0.12326633165829146,  0.1257286432160804,  0.12819095477386935,  0.1306532663316583,  0.13311557788944725,  0.1355778894472362,  0.13804020100502515,  0.1405025125628141,  0.14296482412060302,  0.14542713567839197,  0.14788944723618092,  0.15035175879396986,  0.1528140703517588,  0.15527638190954776,  0.1577386934673367,  0.16020100502512563,  0.16266331658291458,  0.16512562814070353,  0.16758793969849248,  0.17005025125628143,  0.17251256281407037,  0.17497487437185932,  0.17743718592964824,  0.1798994974874372,  0.18236180904522614,  0.1848241206030151,  0.18728643216080404,  0.189748743718593,  0.19221105527638194,  0.19467336683417086,  0.1971356783919598,  0.19959798994974876,  0.2020603015075377,  0.20452261306532665,  0.2069849246231156,  0.20944723618090455,  0.21190954773869347,  0.21437185929648242,  0.21683417085427137,  0.21929648241206032,  0.22175879396984927,  0.22422110552763821,  0.22668341708542716,  0.22914572864321608,  0.23160804020100503,  0.23407035175879398,  0.23653266331658293,  0.23899497487437188,  0.24145728643216083,  0.24391959798994978,  0.2463819095477387,  0.24884422110552765,  0.2513065326633166,  0.2537688442211055,  0.2562311557788945,  0.2586934673366834,  0.2611557788944724,  0.2636180904522613,  0.2660804020100503,  0.2685427135678392,  0.2710050251256282,  0.2734673366834171,  0.275929648241206,  0.278391959798995,  0.2808542713567839,  0.2833165829145729,  0.2857788944723618,  0.2882412060301508,  0.2907035175879397,  0.29316582914572864,  0.2956281407035176,  0.29809045226130654,  0.3005527638190955,  0.30301507537688444,  0.3054773869346734,  0.30793969849246233,  0.31040201005025125,  0.31286432160804023,  0.31532663316582915,  0.3177889447236181,  0.32025125628140705,  0.322713567839196,  0.32517587939698495,  0.32763819095477387,  0.33010050251256284,  0.33256281407035176,  0.33502512562814074,  0.33748743718592966,  0.33994974874371864,  0.34241206030150756,  0.3448743718592965,  0.34733668341708546,  0.3497989949748744,  0.35226130653266335,  0.3547236180904523,  0.35718592964824125,  0.3596482412060302,  0.3621105527638191,  0.36457286432160807,  0.367035175879397,  0.36949748743718597,  0.3719597989949749,  0.37442211055276386,  0.3768844221105528,  0.3793467336683417,  0.3818090452261307,  0.3842713567839196,  0.3867336683417086,  0.3891959798994975,  0.3916582914572865,  0.3941206030150754,  0.3965829145728643,  0.3990452261306533,  0.4015075376884422,  0.4039698492462312,  0.4064321608040201,  0.4088944723618091,  0.411356783919598,  0.41381909547738693,  0.4162814070351759,  0.41874371859296483,  0.4212060301507538,  0.42366834170854273,  0.4261306532663317,  0.4285929648241206,  0.43105527638190955,  0.4335175879396985,  0.43597989949748744,  0.4384422110552764,  0.44090452261306534,  0.4433668341708543,  0.44582914572864324,  0.44829145728643216,  0.45075376884422114,  0.45321608040201006,  0.45567839195979903,  0.45814070351758795,  0.46060301507537693,  0.46306532663316585,  0.4655276381909548,  0.46798994974874375,  0.47045226130653267,  0.47291457286432165,  0.47537688442211057,  0.47783919597989954,  0.48030150753768847,  0.4827638190954774,  0.48522613065326636,  0.4876884422110553,  0.49015075376884426,  0.4926130653266332,  0.49507537688442216,  0.4975376884422111,  0.5]

    a = 0.01
    for ka in kappa :
        if ka > k :
            a = ka
            break

    return first_guess_1(a)


def precedent_guess(k, ky,ome,gam):
    kappa = ky
    omega = ome
    gamma = gam
    index = np.where(kappa == k)
    return complex(omega[index],gamma[index])

def precedent_guess_mod(k, ky,ome,gam):
    kappa = ky
    omega = ome
    gamma = gam
    solution_prec = 1e-12+1j*1e-12
    for index,ka in enumerate(kappa) :
        if ka >= k :
            solution_prec = complex(omega[index],gamma[index])
            break
    return solution_prec

def precedent_openfile(kz,Nkys):
    path = '/home/petronio/Nextcloud/theseLPP/runs/runs_benchmark/MTSI/dispersion_MTSI/dispersion_solver/dispersion_data/general_results/'
    # kappa = np.genfromtxt(path + "ky.txt", delimiter="  ")
    # if kz < 0.0099:
    #     start = 0.001
    #     stop = 0.1
    #     steps = 500
    #     kappa = np.arange(start,stop,(stop-start)/steps)
    # else:
    while True:
        try :
            omega_read = np.genfromtxt(path + "kz={:5.4f}".format(kz) + "_omega_r.txt", delimiter="  ", unpack=False)
            break
        except :
            kz = kz + 0.0001

    gamma_read = np.genfromtxt(path + "kz={:5.4f}".format(kz) + "_gamma.txt", delimiter="  ", unpack=False)

    omega = np.ones(Nkys)*1e-12
    gamma = np.ones(Nkys)*1e-12

    omega[:len(omega_read)] = omega_read
    gamma[:len(gamma_read)] = gamma_read

    start = 0.001
    stop = 0.16
    # steps = 668+84+84+84
    kappa = np.arange(start,stop,(stop-start)/len(gamma_read))
    # print("kappa",len(gamma_read),kappa)

    # print(gamma[:10])
    # solution_prec = 1e-12+1j*1e-12
    # for index,ka in enumerate(kappa) :
    #     if ka+0.00001 >= k :
    #         if index < len(omega):
    #             solution_prec = complex(omega[index],gamma[index])
    #         # print(k,ka, solution_prec)
    #         break
    # print(k,ka, solution_prec)
    return omega, gamma
