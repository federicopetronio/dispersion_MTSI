

from plasmapy.formulary.dispersionfunction import plasma_dispersion_func
from .parameters import PlasmaParameters
import numpy as np

"Normalized permittivity"


def eps_IAW(omg, kx, ky, kz, prt=PlasmaParameters(),
            Ze=plasma_dispersion_func,
            Zi=plasma_dispersion_func):
    def Zep(x):
        return -2 * (1 + x * Ze(x))

    def Zip(x):
        return -2 * (1 + x * Zi(x))

    kp = np.sqrt(ky ** 2 + kz ** 2)
    k2 = kx ** 2 + kp ** 2

    if k2 == 0:
        raise RuntimeError("The wave vector is Zero !!")

    iChi = (omg) / (ky * prt.vti/prt.BohmSpeed)
    eChi = (omg - ky * prt.driftSpeed/prt.BohmSpeed) / (ky * prt.vte/prt.BohmSpeed)

    iEps = 1 / (ky**2 * (prt.vti/prt.BohmSpeed) ** 2) * Zip(iChi)
    eEps = (prt.electronPlasmaFrequency/prt.ionPlasmaFrequency) ** 2 / (ky**2 * (prt.vte/prt.BohmSpeed) ** 2) * Zep(eChi)

    return 1 - iEps - eEps

def analytic_IAW(k, ti=0):
    return np.sqrt(1/(1 + 1/(k**2))*(1 + 3*ti*(1+k**2)))


def analytic_IAW_simple(k, ti=0):
    return np.sqrt(1/(1 + 1/(k**2)))

def first_guess(k):
    kappa = [0.01,  0.02,  0.03,  0.04,  0.05,  0.060000000000000005,  0.06999999999999999,  0.08,  0.09,  0.09999999999999999,  0.11,  0.12,  0.13,  0.14,  0.15000000000000002,  0.16,  0.17,  0.18000000000000002,  0.19,  0.2,  0.21000000000000002,  0.22,  0.23,  0.24000000000000002,  0.25,  0.26,  0.27,  0.28,  0.29000000000000004,  0.3,  0.31,  0.32,  0.33,  0.34,  0.35000000000000003,  0.36000000000000004,  0.37,  0.38,  0.39,  0.4,  0.41000000000000003,  0.42000000000000004,  0.43,  0.44,  0.45,  0.46,  0.47000000000000003,  0.48000000000000004,  0.49,  0.5,  0.51,  0.52,  0.53,  0.54,  0.55,  0.56,  0.5700000000000001,  0.5800000000000001,  0.59,  0.6,  0.61,  0.62,  0.63,  0.64,  0.65,  0.66,  0.67,  0.68,  0.6900000000000001,  0.7000000000000001,  0.7100000000000001,  0.72,  0.73,  0.74,  0.75,  0.76,  0.77,  0.78,  0.79,  0.8,  0.81,  0.8200000000000001,  0.8300000000000001,  0.8400000000000001,  0.85,  0.86,  0.87,  0.88,  0.89,  0.9,  0.91,  0.92,  0.93,  0.9400000000000001,  0.9500000000000001,  0.9600000000000001,  0.97,  0.98,  0.99,  1.0,  1.01,  1.02,  1.03,  1.04,  1.05,  1.06,  1.07,  1.08,  1.09,  1.1,  1.11,  1.12,  1.1300000000000001,  1.1400000000000001,  1.1500000000000001,  1.1600000000000001,  1.17,  1.18,  1.19,  1.2,  1.21,  1.22,  1.23,  1.24,  1.25,  1.26,  1.27,  1.28,  1.29,  1.3,  1.31,  1.32,  1.33,  1.34,  1.35,  1.36,  1.37,  1.3800000000000001,  1.3900000000000001,  1.4000000000000001,  1.4100000000000001,  1.42,  1.43,  1.44,  1.45,  1.46,  1.47,  1.48,  1.49,  1.5,  1.51,  1.52,  1.53,  1.54,  1.55,  1.56,  1.57,  1.58,  1.59,  1.6,  1.61,  1.62,  1.6300000000000001,  1.6400000000000001,  1.6500000000000001,  1.6600000000000001,  1.6700000000000002,  1.68,  1.69,  1.7,  1.71,  1.72,  1.73,  1.74,  1.75,  1.76,  1.77,  1.78,  1.79,  1.8,  1.81,  1.82,  1.83,  1.84,  1.85,  1.86,  1.87,  1.8800000000000001,  1.8900000000000001,  1.9000000000000001,  1.9100000000000001,  1.9200000000000002,  1.93,  1.94,  1.95,  1.96,  1.97,  1.98,  1.99,  2.0]

    omega = [3.855632314097145e-05,  0.00026833655939895314,  0.0009742504069268391,  0.0031373186350854556,  0.014960261299687382,  0.42437735324334547,  0.40512650098888103,  0.32536987921794247,  0.2987927593128488,  0.2860996150792098,  0.2789427781668748,  0.2744397449334318,  0.27134881621866547,  0.2690599646597466,  0.2672456420725374,  0.26571812431307906,  0.2643642213748332,  0.2631128008643359,  0.26191756398328125,  0.26074743059344274,  0.25958094081340566,  0.25840287741453283,  0.2572021648650509,  0.25597052708628976,  0.2547016092931358,  0.25339039096056637,  0.25203278553322894,  0.25062536231027854,  0.24916514967221806,  0.24764949330106367,  0.24607595207140937,  0.2444422200267008,  0.24274606655851155,  0.24098528933917696,  0.23915767617256645,  0.23726097301628668,  0.2352928561613924,  0.2332509070581626,  0.23113258861196223,  0.22893522199978739,  0.22665596319793674,  0.22429177849371318,  0.2218394182825023,  0.21929538844129887,  0.2166559185173218,  0.21391692587730476,  0.21107397482547538,  0.20812222950431697,  0.20505639913187376,  0.20187067378005719,  0.19855864843134688,  0.1951132324254195,  0.19152654056167856,  0.18778976096663577,  0.18389299323900143,  0.17982504814428785,  0.1755731969439842,  0.17112285382082076,  0.16645716803514166,  0.16155649213196713,  0.15639767655629697,  0.15095311562740021,  0.1451894280979164,  0.13906558445366196,  0.13253016683349783,  0.1255172116173186,  0.11793961717333384,  0.1096781019569388,  0.10056136612657612,  0.09032696287287961,  0.07853328653842076,  0.06431721408350072,  0.04542648587812906,  0.017884598838875828,  0.1893103369039436,  0.30108212094098963,  0.3956698471439918,  0.48048703122322756,  0.5586838696950294,  0.6319743425778335,  0.7014228029296251,  0.7677479741714965,  0.831463874791651,  0.892954805015603,  0.952517428923843,  1.010386690742037,  1.0667533168015808,  1.121774163796529,  1.1755806522677785,  1.2282839093830793,  1.2799795515983132,  1.3307500684828282,  1.3806674099951473,  1.429795066678429,  1.478188587790354,  1.5258984243553315,  1.5729690152412608,  1.6194403927835719,  1.6653490111342575,  1.7107277133797147,  1.7556065972129733,  1.800012941718189,  1.843971916946125,  1.887506635435309,  1.9306383912574834,  1.9733871484657524,  2.0157709642030923,  2.0578063064743795,  2.0995097281959363,  2.140895403891278,  2.1819776075463855,  2.2227683714508886,  2.263280569143788,  2.3035252185415076,  2.3435129239086185,  2.383253653294454,  2.4227567139949278,  2.4620315250850773,  2.5010861620489906,  2.5399286019309426,  2.578566630185567,  2.6170071121135026,  2.6552570635918826,  2.6933228021757447,  2.731210561059072,  2.7689262097896776,  2.806475250710627,  2.843863219388096,  2.8810949475133403,  2.9181752628692816,  2.9551088638181797,  2.9919000503372057,  3.028553804797194,  3.0650731769392574,  3.101462034747448,  3.1377253623313477,  3.173865388701417,  3.2098865282704896,  3.2457910297999524,  3.281582839377294,  3.3172648451655666,  3.352840050622163,  3.388311212016305,  3.423680811045725,  3.45895163621938,  3.4941263139175724,  3.529207331979239,  3.5641969622039653,  3.599096877994125,  3.633909995970069,  3.6686384391822116,  3.7032839174271057,  3.737848579557655,  3.7723340606508122,  3.806742570867213,  3.8410755455594408,  3.8753350165370755,  3.9095223444021734,  3.9436395425496484,  3.9776879666263323,  4.011669033364692,  4.0455843088799615,  4.079435167739076,  4.113222970001173,  4.146949149877813,  4.18061511146119,  4.21422206978208,  4.247771035378959,  4.281263406546335,  4.314700569582596,  4.348083274108458,  4.381412327435914,  4.414689426831379,  4.447915293166931,  4.481091748751377,  4.514217973969958,  4.547296376979274,  4.5803272610683035,  4.613312135719262,  4.646251212622495,  4.67914614799415,  4.7119966387934635,  4.7448043180274935,  4.777570047829907,  4.810294146361882,  4.842977462254822,  4.875620967453994,  4.9082252784479845,  4.940791176714205,  4.973318992771403,  5.005809729585305,  5.038263739312466,  5.070682088073876,  5.103065125771565,  5.135413517281476,  5.167727729828497,  5.200008286154768,  5.232256043000801,  5.264471630106382,  5.296655127049349 ]

    gamma = [0.008429449246709264,  0.031261366025541595,  0.07103142231990635,  0.1358727417302637,  0.26438027252692,  0.6135480750698664,  4.2411407522515625e-14,  4.128471537558389e-14,  4.090660499957592e-14,  3.3594169575339065e-14,  3.149478916465077e-14,  2.8599523824211406e-14,  2.66156132678571e-14,  2.8058646471667584e-14,  2.7451782708498143e-14,  2.8216531475296538e-14,  2.405593703651762e-14,  1.9301686405397667e-14,  1.8862984923828143e-14,  1.8905120716777093e-14,  1.7529524002257972e-14,  1.8007539465325008e-14,  1.6248623053338652e-14,  1.4662664810137832e-14,  1.2499608562384315e-14,  1.1594312267164713e-14,  1.1915229857130157e-14,  1.194849888435659e-14,  1.0489744152449363e-14,  8.948186765742898e-15,  8.081796051242874e-15,  8.108624128258466e-15,  7.325894071078653e-15,  7.352463538453534e-15,  6.828909020877903e-15,  6.855988254756435e-15,  7.055823708205032e-15,  6.733648906837554e-15,  6.595884226975158e-15,  6.792134712683838e-15,  6.6561422908016015e-15,  5.526031565464041e-15,  5.418091023060623e-15,  4.7718966786019104e-15,  4.800614286055993e-15,  4.590928570604489e-15,  4.506662024185189e-15,  4.538173532306761e-15,  4.344690574519973e-15,  4.052588010832362e-15,  3.579259244754679e-15,  3.2523872108769417e-15,  3.119661544886708e-15,  3.2280861701458113e-15,  3.180876528862781e-15,  3.136537117281336e-15,  3.252031277971492e-15,  3.1306451595000758e-15,  3.09505774435631e-15,  2.7537364207020305e-15,  2.5911722908854927e-15,  2.506715994117394e-15,  1.927892674668277e-15,  1.920352978184956e-15,  1.9654766827300823e-15,  1.9683422654841842e-15,  1.9293405073736468e-15,  1.9486808784329213e-15,  1.9809536277635743e-15,  1.8341379387754526e-15,  1.9538764338752586e-15,  1.837640037784823e-15,  -1.6880877276670598e-17,  -1.9690298932933677e-17,  1.1680872902139346e-17,  8.050074228178792e-18,  6.785574752973814e-18,  6.058284883578038e-18, 03.8372197018981084e-18  3.864641963107766e-18  3.815765801820974e-18  3.9599607729224005e-18  4.0122140213654735e-18  3.966372106898261e-18  3.9720394753949786e-18  4.0286853275898694e-18  3.986679770000269e-18  3.946282822242349e-18  4.104702268347801e-18  4.167936720626139e-18  4.128978180870283e-18  4.117156896504254e-18  4.1834810916739835e-18  4.042582803720385e-18  3.907241659433252e-18  3.923700397349434e-18  3.891897247039278e-18  3.884593335459091e-18  3.8544290241714745e-18  3.9214724812847964e-18  3.990279237695497e-18  4.035936183865157e-18  4.007006613575581e-18  3.978822747108404e-18  4.050821270380526e-18  4.0233549455093175e-18  4.12307095623563e-18  4.160504411063908e-18  4.2377437253519116e-18  4.4228136162933235e-18  4.505851881201128e-18  4.590897592364659e-18  4.677990699322548e-18  4.650221910690285e-18  4.739291486390838e-18  4.948962703339176e-18  5.044603148206058e-18  5.016389695821514e-18  4.9887314665778334e-18  4.9616091975723755e-18  4.935004407958393e-18  4.932032456044088e-18  4.969867408010013e-18  5.006383332665525e-18  4.9887504174355045e-18  4.963706897571596e-18  5.0631937233500504e-18  4.911824981610023e-18  4.888069585692856e-18  4.864712506512031e-18  4.841742091996392e-18  5.053676122256251e-18  5.095508497160124e-18  5.2175713295320794e-18  5.291872179101267e-18  5.40056924710045e-18  5.376747947687506e-18  5.353287335500069e-18  5.464010028854716e-18  5.577270981596025e-18  5.553695422347374e-18  5.808145310004801e-18  5.784092413319997e-18  5.904981525684218e-18  5.585763397211353e-18  5.563312093674011e-18  5.541167631072752e-18  5.5193224278526615e-18  5.635752214860233e-18  5.473056589416208e-18  5.5889068885354456e-18  5.5676828406551314e-18  5.54673107395349e-18  5.6647131568232524e-18  5.891606316622689e-18  5.722730478835522e-18  5.701945947605479e-18  5.698676635334842e-18  5.415657488316569e-18  5.531877802944067e-18  5.374162261494026e-18  5.355453229512216e-18  5.454112454859188e-18  5.431172382248587e-18  5.412721460409193e-18  5.9357517085152584e-18  5.915904893516776e-18  5.9517405937510094e-18  6.080942395817477e-18  6.099084860657118e-18  6.0793138575539956e-18  6.05975540179805e-18  6.040405609777294e-18  6.1156418453465216e-18  6.172846254743835e-18  6.307887862959235e-18  6.367177335296527e-18  6.506755056303231e-18  6.6495349347090364e-18  ]

    return complex(omega[kappa.index(k)],gamma[kappa.index(k)])
